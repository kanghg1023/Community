<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hk.login">

<!-- 	회원가입 -->
	<insert id="insertUser" parameterType="LoginDto">
		INSERT INTO R_USER VALUES
		(#{rid},#{rpassword},#{rname},#{raddress},#{rphone},#{remail},'Y','USER')
	</insert>
	
	<sql id="asd">
		SELECT RID, RPASSWORD, RNAME, RADDRESS, RPHONE, REMAIL, RENABLED, RROLE
		FROM R_USER
	</sql>
<!-- 	로그인 -->
	<select id="getLogin" parameterType="LoginDto" resultType="LoginDto">
		<include refid="asd"></include>
		WHERE RID=#{rid} AND RPASSWORD=#{rpassword}
	</select>
	
<!-- 	내 정보 조회 -->
	<select id="userinfo" parameterType="String" resultType="LoginDto">
		<include refid="asd"></include>
		WHERE RID=#{rid}
	</select>
	
<!-- 	정보수정 -->
	<update id="userUpdate" parameterType="LoginDto">
		UPDATE R_USER SET RADDRESS=#{raddress}, RPHONE=#{rphone},
		REMAIL=#{remail} WHERE RID=#{rid}
	</update>
	
<!-- 	회원탈퇴 -->
	<update id="withdraw" parameterType="String">
		UPDATE R_USER SET RENABLED='N' WHERE RID=#{rid}
	</update>
	
<!-- 	아이디 중복체크 -->
	<select id="idChk" parameterType="String" resultType="LoginDto">
		SELECT RID FROM R_USER WHERE RID=#{rid}
	</select>
	
<!-- 	중복쿼리 -->
	<sql id="a">
		SELECT RID, RPASSWORD, RNAME, RADDRESS, RPHONE, REMAIL, RENABLED, RROLE
		FROM R_USER
	</sql>
	
<!-- 	전체 회원 조회(탈퇴O) -->
	<select id="getAllUserStatus" resultType="LoginDto">
		<include refid="a"/>
		ORDER BY RENABLED, RNAME
	</select>
	
<!-- 	사용자 조회(탈퇴X) -->
	<select id="getAllUserList" resultType="LoginDto">
		<include refid="a"/>
		WHERE RENABLED='Y' ORDER BY RENABLED, RNAME
	</select>
	
<!-- 	사용자 상세조회 -->
	<select id="getUser" parameterType="String" resultType="LoginDto">
		<include refid="a"/>
		 WHERE RID=#{rid}
	</select>
	
<!-- 	사용자 등급 변경 -->
	<update id="updateUserRole" parameterType="LoginDto">
		UPDATE R_USER SET RROLE=#{rrole} WHERE RID=#{rid}
	</update>
	
</mapper>
